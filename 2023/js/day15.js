import { runDay, sum } from '../../utils.js';

// https://adventofcode.com/2023/day/15

console.log(part2(`rn=1,cm-,qp=3,cm=2,qp-,pc=4,ot=9,ab=5,pc-,pc=6,ot=7`));

runDay(2023, 15)
  // .part(1, part1) // 495972
  .part(2, part2) // low 244845, hight 907854
  .end();

function part1(inp) {
  let hashs = inp
    .split(',')
    .map((part) => {
      let h = 0;

      part.split('').forEach((ch) => {
        h += ch.charCodeAt(0);
        h *= 17;
        h = h % 256;
      });
      // console.log(part, h);
      return h;
    });

  return sum(hashs);
}

function part2(inp) {
  let boxes = {};

  inp
    .split(',')
    .map((part) => {
      let label = part.split(/[=-]/)[0];
      let remove = part.includes('-');

      let h = 0;
      label.split('').forEach((ch) => {
        h += ch.charCodeAt(0);
        h *= 17;
        h = h % 256;
      });
      // console.log(part, { remove });

      if (!boxes[h]) {
        boxes[h] = [];
      }

      if (remove) {
        boxes[h] = boxes[h].filter(it => !it.startsWith(label));
      } else {
        let ind = boxes[h].findIndex(it => it.startsWith(label));
        if (ind > -1) {
          boxes[h][ind] = part;
        } else {
          boxes[h].push(part);
        }
      }

      // console.log(boxes);

      return h;
    });
  console.log(boxes);

  let ccc = Object.entries(boxes).map(([key, parts]) => {
    return sum(parts.map((part, i) => {
      let [str, n] = part.split(/[=-]/);
      n = +n;
      // console.log(part, [(+key + 1) , (i + 1) , n]);

      return (+key + 1) * (i + 1) * n;
    }));
  });

  return sum(ccc);
}

/*{
  '0': [ 'thhvf=2' ],
  '1': [],
  '2': [ 'pr=3', 'lcc=6', 'hbhvz=8' ],
  '3': [],
  '4': [],
  '5': [],
  '7': [ 'ctms=3', 'ssns=2' ],
  '8': [ 'km=5' ],
  '10': [ 'ttvl=1' ],
  '11': [ 'gsq=8' ],
  '12': [ 'hd=7' ],
  '13': [ 'zmpf=9', 'gf=1', 'vct=8', 'vdc=9' ],
  '14': [ 'pnp=7', 'thzx=5', 'qxsddj=8', 'jpksf=2', 'dnjdn=1' ],
  '15': [ 'gph=3', 'vqh=7' ],
  '18': [ 'sdcx=3' ],
  '19': [ 'ps=7' ],
  '20': [],
  '22': [],
  '23': [ 'lvzqj=4' ],
  '24': [ 'bqgn=3' ],
  '25': [ 'kn=4' ],
  '26': [ 'fldd=6' ],
  '27': [ 'xs=3' ],
  '28': [],
  '29': [],
  '30': [ 'dxb=5' ],
  '31': [ 'jqhl=8' ],
  '32': [ 'xnbx=6', 'dlsm=5' ],
  '33': [ 'sn=5' ],
  '34': [ 'nqxk=2' ],
  '35': [],
  '36': [ 'bb=6', 'klzc=5', 'ctm=8' ],
  '37': [ 'glb=6' ],
  '39': [ 'mz=3' ],
  '40': [],
  '41': [],
  '42': [ 'bbf=5' ],
  '43': [ 'qlqm=2' ],
  '45': [ 'hrc=5' ],
  '46': [],
  '47': [ 'dxc=6', 'gh=5' ],
  '48': [ 'fj=7' ],
  '49': [ 'xml=8' ],
  '50': [ 'dn=7' ],
  '51': [ 'rq=2', 'cvj=6', 'kfr=4' ],
  '52': [ 'gcmgdr=3', 'br=1', 'qs=7' ],
  '53': [ 'tqp=6', 'bvm=2' ],
  '54': [],
  '55': [ 'fmd=9', 'rsr=2' ],
  '56': [ 'kvsd=5', 'mmn=7' ],
  '57': [ 'hvk=5' ],
  '58': [ 'dnh=9', 'qspjl=5' ],
  '60': [ 'zb=8' ],
  '61': [],
  '62': [ 'xf=1' ],
  '63': [],
  '64': [ 'vj=4' ],
  '65': [],
  '66': [ 'lfp=8' ],
  '67': [ 'zhq=5', 'sp=1' ],
  '69': [ 'bhk=9' ],
  '70': [],
  '71': [ 'pg=9', 'cvmq=6', 'kcgxz=7' ],
  '72': [ 'php=3' ],
  '73': [],
  '74': [ 'nbcg=8', 'mlq=8' ],
  '75': [],
  '76': [ 'thbn=6' ],
  '77': [ 'zc=1' ],
  '78': [ 'xv=7', 'ptdf=7', 'gts=4', 'jnv=9' ],
  '79': [],
  '80': [ 'hh=1', 'vz=7' ],
  '81': [ 'rmhz=3' ],
  '82': [ 'cdzfk=9', 'fl=3' ],
  '83': [],
  '84': [ 'sq=2', 'nqjk=1' ],
  '85': [ 'xltm=9', 'sb=3' ],
  '86': [],
  '88': [],
  '89': [ 'rds=5' ],
  '90': [ 'kvcv=8' ],
  '91': [],
  '92': [],
  '93': [ 'dgtn=1', 'jbmd=2' ],
  '94': [ 'lpbrxv=7', 'hdr=4', 'cnm=6' ],
  '95': [ 'lsbn=6' ],
  '96': [ 'kbvm=4' ],
  '97': [],
  '99': [],
  '100': [ 'tp=9', 'lhgdbs=9' ],
  '101': [ 'llkb=2' ],
  '102': [ 'ldv=8', 'rt=8', 'cs=8' ],
  '103': [],
  '104': [ 'tflb=2', 'qg=3' ],
  '105': [ 'glf=6' ],
  '106': [ 'rdt=6', 'sqv=3' ],
  '107': [ 'spx=5', 'dbcb=3', 'nm=8' ],
  '108': [ 'gcfl=9' ],
  '109': [ 'lq=7', 'mfgxcx=8' ],
  '110': [ 'zt=2' ],
  '111': [ 'kd=1' ],
  '112': [ 'jf=7', 'xx=6', 'hrv=1', 'fvt=5' ],
  '113': [ 'klj=9', 'hrg=9' ],
  '115': [ 'rtkb=6' ],
  '117': [ 'qjgqb=1' ],
  '118': [ 'dr=8' ],
  '119': [ 'ct=3' ],
  '120': [],
  '121': [ 'rgxnz=4' ],
  '122': [ 'cxjsr=9' ],
  '124': [ 'crg=8' ],
  '125': [],
  '126': [],
  '127': [ 'lc=9' ],
  '128': [ 'psm=2' ],
  '129': [ 'mxl=6', 'hcv=4' ],
  '130': [ 'hrh=4' ],
  '131': [ 'rmd=6', 'hk=6' ],
  '132': [ 'tvz=5' ],
  '133': [],
  '134': [],
  '135': [ 'ds=5', 'st=3' ],
  '136': [ 'stdm=2', 'ltljr=6', 'rv=8', 'dd=1' ],
  '137': [ 'qx=9' ],
  '138': [],
  '140': [ 'cdcb=9' ],
  '142': [ 'jrr=1' ],
  '143': [ 'ls=1' ],
  '144': [ 'zv=8', 'ctml=8' ],
  '145': [ 'psn=2' ],
  '146': [ 'jh=4' ],
  '147': [],
  '148': [ 'mgp=5', 'bjrvxh=5' ],
  '149': [],
  '150': [ 'hgct=7' ],
  '151': [ 'lmxv=2' ],
  '152': [],
  '153': [],
  '154': [ 'xzh=7', 'cg=9', 'bx=4' ],
  '155': [ 'xjkhv=1', 'rsvp=5' ],
  '156': [ 'pl=6', 'qgt=4' ],
  '157': [ 'nflm=5' ],
  '158': [ 'np=4', 'zcq=8' ],
  '160': [ 'tghsj=6', 'ghq=8' ],
  '162': [ 'zh=5' ],
  '164': [],
  '167': [ 'jctv=3', 'lhc=3' ],
  '168': [ 'sqftz=6' ],
  '169': [ 'sv=2' ],
  '170': [ 'df=1', 'sg=2' ],
  '171': [ 'rvs=9' ],
  '172': [ 'rft=1' ],
  '173': [],
  '174': [],
  '175': [],
  '176': [ 'xxfz=9', 'nb=7', 'lnv=5' ],
  '177': [],
  '178': [ 'lpjl=1', 'dmq=7' ],
  '179': [ 'zrcqs=4', 'kh=5' ],
  '180': [ 'jrkql=6' ],
  '181': [ 'xm=9' ],
  '182': [],
  '183': [],
  '184': [ 'pnsqf=8' ],
  '186': [ 'dv=9', 'rsvzkj=3' ],
  '187': [ 'cx=8', 'dg=5' ],
  '188': [],
  '189': [],
  '191': [],
  '193': [],
  '194': [],
  '195': [],
  '196': [ 'zj=7' ],
  '198': [],
  '199': [],
  '200': [ 'jqqkmd=4', 'vr=6' ],
  '201': [ 'zrfvq=4', 'gb=1', 'vc=4', 'xjhdk=4' ],
  '202': [ 'tv=6' ],
  '203': [ 'smsh=9' ],
  '204': [],
  '205': [ 'trgjf=9' ],
  '206': [ 'ssx=6' ],
  '207': [],
  '208': [ 'dvlpz=5' ],
  '210': [],
  '212': [ 'zpj=3', 'zz=5', 'lh=2' ],
  '213': [ 'kj=8' ],
  '214': [ 'qbc=4', 'lmznsr=9' ],
  '215': [],
  '216': [],
  '217': [],
  '218': [ 'gnhm=3', 'gc=7' ],
  '219': [ 'jkf=6', 'jkdr=4' ],
  '220': [],
  '223': [ 'sth=9', 'bm=9' ],
  '224': [],
  '225': [],
  '226': [ 'zdd=8', 'btl=4' ],
  '227': [],
  '228': [],
  '229': [ 'ghf=1', 'kz=5' ],
  '230': [ 'kdts=8', 'kk=6', 'ztgnkx=2' ],
  '231': [ 'pbdgnl=9' ],
  '232': [ 'qvkv=3' ],
  '233': [ 'rmj=5', 'clj=3' ],
  '234': [ 'hpr=6' ],
  '235': [],
  '236': [ 'lzskx=8', 'sfkpbv=9', 'tx=9' ],
  '237': [ 'fqv=9' ],
  '238': [ 'jxl=7', 'mcn=4' ],
  '239': [ 'xkl=2' ],
  '240': [ 'bvx=9' ],
  '241': [ 'pjg=9' ],
  '244': [],
  '245': [ 'tnc=3', 'blqv=9' ],
  '247': [ 'kl=7' ],
  '248': [],
  '249': [ 'fgl=8', 'fdcl=8' ],
  '250': [ 'hqpq=9' ],
  '251': [],
  '252': [ 'fv=4' ],
  '253': [],
  '254': [ 'mpcvh=5', 'tj=1', 'dz=3' ],
  '255': [ 'dk=2' ]
}
*/