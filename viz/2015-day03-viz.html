<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AoC 2015 Day 3 - Visualization</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Courier New", monospace;
        background: #f5f5f5;
        color: #333;
        padding: 40px 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      header {
        margin-bottom: 30px;
        text-align: center;
      }
      h1 {
        color: #2c3e50;
        margin-bottom: 10px;
        font-size: 1.8em;
      }
      .subtitle {
        color: #7f8c8d;
        font-size: 0.9em;
        margin-bottom: 15px;
      }
      .links {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-bottom: 20px;
      }
      .link {
        color: #3498db;
        text-decoration: none;
        font-size: 0.85em;
      }
      .link:hover {
        text-decoration: underline;
      }
      .controls {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
      }
      .control-row {
        display: flex;
        gap: 15px;
        align-items: center;
        margin-bottom: 15px;
      }
      label {
        color: #7f8c8d;
        font-size: 0.9em;
      }
      textarea {
        flex: 1;
        height: 80px;
        background: #fafafa;
        border: 1px solid #ddd;
        border-radius: 3px;
        color: #333;
        font-family: "Courier New", monospace;
        font-size: 13px;
        padding: 10px;
        resize: vertical;
      }
      textarea:focus {
        outline: none;
        border-color: #3498db;
        background: #fff;
      }
      .button-group {
        display: flex;
        gap: 10px;
      }
      button {
        background: #3498db;
        color: #fff;
        border: none;
        border-radius: 3px;
        padding: 10px 20px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
        cursor: pointer;
        transition: background 0.2s;
      }
      button:hover {
        background: #2980b9;
      }
      button:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
      }
      .mode-toggle {
        display: flex;
        gap: 5px;
      }
      .mode-btn {
        background: #ecf0f1;
        color: #7f8c8d;
        padding: 8px 16px;
      }
      .mode-btn.active {
        background: #3498db;
        color: #fff;
      }
      .viz-container {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 600px;
      }
      .stats {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 15px;
      }
      .stat {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 3px;
        padding: 12px 20px;
        text-align: center;
      }
      .stat-label {
        color: #7f8c8d;
        font-size: 0.85em;
        margin-bottom: 5px;
      }
      .stat-value {
        color: #27ae60;
        font-weight: bold;
        font-size: 1.3em;
      }
      #canvas {
        border: 1px solid #ddd;
        background: #fafafa;
      }
      .legend {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 15px;
        font-size: 0.85em;
      }
      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 3px;
        border: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Day 3: Perfectly Spherical Houses in a Vacuum</h1>
      <div class="subtitle">Path Visualization</div>
      <div class="links">
        <a href="2015.html" class="link">← Back to Solver</a>
        <a href="https://adventofcode.com/2015/day/3" target="_blank" class="link">View Problem →</a>
      </div>
    </header>

    <div class="controls">
      <div class="control-row">
        <label>Input:</label>
        <textarea id="input" placeholder="Paste your input here (e.g., ^>v<)"></textarea>
      </div>
      <div class="control-row">
        <div class="mode-toggle">
          <button class="mode-btn active" data-mode="1">Part 1: Santa Only</button>
          <button class="mode-btn" data-mode="2">Part 2: Santa + Robo-Santa</button>
        </div>
        <div class="button-group">
          <button id="visualizeBtn">Visualize</button>
          <button id="resetBtn">Reset</button>
        </div>
      </div>
    </div>

    <div class="viz-container">
      <canvas id="canvas" width="800" height="800"></canvas>
    </div>

    <div class="stats">
      <div class="stat">
        <div class="stat-label">Houses Visited</div>
        <div class="stat-value" id="housesVisited">-</div>
      </div>
      <div class="stat">
        <div class="stat-label">Total Moves</div>
        <div class="stat-value" id="totalMoves">-</div>
      </div>
    </div>

    <div class="legend" id="legend">
      <div class="legend-item">
        <div class="legend-color" style="background: #3498db;"></div>
        <span>Santa's Path</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #e8f4f8;"></div>
        <span>Visited House</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background: #27ae60;"></div>
        <span>Starting Point</span>
      </div>
    </div>

    <script>
      const STORAGE_KEY = "aoc-2015-day03-viz";

      const inputEl = document.getElementById("input");
      const visualizeBtn = document.getElementById("visualizeBtn");
      const resetBtn = document.getElementById("resetBtn");
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const housesVisitedEl = document.getElementById("housesVisited");
      const totalMovesEl = document.getElementById("totalMoves");
      const legendEl = document.getElementById("legend");

      let currentMode = 1;

      // Mode toggle
      document.querySelectorAll(".mode-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".mode-btn").forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          currentMode = parseInt(btn.dataset.mode);
          updateLegend();
        });
      });

      function updateLegend() {
        if (currentMode === 1) {
          legendEl.innerHTML = `
            <div class="legend-item">
              <div class="legend-color" style="background: #3498db;"></div>
              <span>Santa's Path</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #e8f4f8;"></div>
              <span>Visited House</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #27ae60;"></div>
              <span>Starting Point</span>
            </div>
          `;
        } else {
          legendEl.innerHTML = `
            <div class="legend-item">
              <div class="legend-color" style="background: #3498db;"></div>
              <span>Santa's Path</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #e74c3c;"></div>
              <span>Robo-Santa's Path</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #e8f4f8;"></div>
              <span>Visited House</span>
            </div>
            <div class="legend-item">
              <div class="legend-color" style="background: #27ae60;"></div>
              <span>Starting Point</span>
            </div>
          `;
        }
      }

      function visualize() {
        const input = inputEl.value.trim();
        if (!input) {
          alert("Please enter some input");
          return;
        }

        const dirMap = {
          ">": [1, 0],
          "<": [-1, 0],
          "^": [0, -1],
          "v": [0, 1],
        };

        // Calculate all positions
        let positions = [];
        let visited = new Set();
        visited.add("0,0");

        if (currentMode === 1) {
          // Part 1: Santa only
          let pos = [0, 0];
          positions.push({ x: 0, y: 0, agent: "santa" });

          input.split("").forEach((dir) => {
            if (dirMap[dir]) {
              pos = [pos[0] + dirMap[dir][0], pos[1] + dirMap[dir][1]];
              positions.push({ x: pos[0], y: pos[1], agent: "santa" });
              visited.add(`${pos[0]},${pos[1]}`);
            }
          });
        } else {
          // Part 2: Santa and Robo-Santa
          let santaPos = [0, 0];
          let roboPos = [0, 0];
          positions.push({ x: 0, y: 0, agent: "both" });

          input.split("").forEach((dir, i) => {
            if (dirMap[dir]) {
              if (i % 2 === 0) {
                santaPos = [santaPos[0] + dirMap[dir][0], santaPos[1] + dirMap[dir][1]];
                positions.push({ x: santaPos[0], y: santaPos[1], agent: "santa" });
                visited.add(`${santaPos[0]},${santaPos[1]}`);
              } else {
                roboPos = [roboPos[0] + dirMap[dir][0], roboPos[1] + dirMap[dir][1]];
                positions.push({ x: roboPos[0], y: roboPos[1], agent: "robo" });
                visited.add(`${roboPos[0]},${roboPos[1]}`);
              }
            }
          });
        }

        // Find bounds
        const xs = positions.map((p) => p.x);
        const ys = positions.map((p) => p.y);
        const minX = Math.min(...xs);
        const maxX = Math.max(...xs);
        const minY = Math.min(...ys);
        const maxY = Math.max(...ys);

        const width = maxX - minX + 1;
        const height = maxY - minY + 1;

        // Calculate cell size
        const padding = 20;
        const availableWidth = canvas.width - padding * 2;
        const availableHeight = canvas.height - padding * 2;
        const cellSize = Math.min(
          availableWidth / width,
          availableHeight / height,
          20
        );

        // Clear canvas
        ctx.fillStyle = "#fafafa";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Center the grid
        const offsetX = (canvas.width - width * cellSize) / 2;
        const offsetY = (canvas.height - height * cellSize) / 2;

        // Draw visited houses
        visited.forEach((key) => {
          const [x, y] = key.split(",").map(Number);
          const screenX = offsetX + (x - minX) * cellSize;
          const screenY = offsetY + (y - minY) * cellSize;

          ctx.fillStyle = "#e8f4f8";
          ctx.fillRect(screenX, screenY, cellSize, cellSize);
          ctx.strokeStyle = "#ddd";
          ctx.lineWidth = 0.5;
          ctx.strokeRect(screenX, screenY, cellSize, cellSize);
        });

        // Draw paths
        for (let i = 1; i < positions.length; i++) {
          const from = positions[i - 1];
          const to = positions[i];

          const fromX = offsetX + (from.x - minX) * cellSize + cellSize / 2;
          const fromY = offsetY + (from.y - minY) * cellSize + cellSize / 2;
          const toX = offsetX + (to.x - minX) * cellSize + cellSize / 2;
          const toY = offsetY + (to.y - minY) * cellSize + cellSize / 2;

          ctx.beginPath();
          ctx.moveTo(fromX, fromY);
          ctx.lineTo(toX, toY);

          if (to.agent === "santa") {
            ctx.strokeStyle = "#3498db";
          } else if (to.agent === "robo") {
            ctx.strokeStyle = "#e74c3c";
          } else {
            ctx.strokeStyle = "#3498db";
          }

          ctx.lineWidth = 2;
          ctx.stroke();
        }

        // Draw starting point
        const startX = offsetX + (0 - minX) * cellSize;
        const startY = offsetY + (0 - minY) * cellSize;
        ctx.fillStyle = "#27ae60";
        ctx.fillRect(startX, startY, cellSize, cellSize);
        ctx.strokeStyle = "#229954";
        ctx.lineWidth = 2;
        ctx.strokeRect(startX, startY, cellSize, cellSize);

        // Update stats
        housesVisitedEl.textContent = visited.size;
        totalMovesEl.textContent = input.length;
      }

      function reset() {
        ctx.fillStyle = "#fafafa";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        housesVisitedEl.textContent = "-";
        totalMovesEl.textContent = "-";
      }

      visualizeBtn.addEventListener("click", visualize);
      resetBtn.addEventListener("click", reset);

      inputEl.addEventListener("input", () => {
        localStorage.setItem(STORAGE_KEY, inputEl.value);
      });

      // Load saved input
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          inputEl.value = saved;
        }
      } catch (err) {
        console.log(err);
      }
    </script>
  </body>
</html>
